{"version":3,"sources":["js/component/GoogleOAuth.js"],"names":["GoogleOAuth","Component","componentDidMount","props","state","displayMenu","port","Math","floor","random","OAuthClient","auth","OAuth2","config","GoogleClientId","GoogleClientSecret","gurl","generateAuthUrl","access_type","scope","send","server","createServer","listen","onRequest","request","response","end","close","queryData","parse","url","query","error","window","logger","pageBack","code","getToken","err","tokens","GoogleAccessToken","access_token","GoogleRefreshToken","refresh_token","GoogleTokenValidTill","expiry_date","on","prevPage","page","render"],"mappings":";;;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;IAGMA,W,WADL,uBAAO,QAAP,C,UAAkB,uBAAO,OAAP,C,+BACnB,MAAMA,WAAN,SAA0B,gBAAMC,SAAhC,CAA0C;;AAEtCC,wBAAmB;AACf,aAAKC,KAAL,CAAWC,KAAX,CAAiBC,WAAjB,GAA+B,KAA/B;AACA,YAAIC,OAAOC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,MAAiB,QAAM,KAAvB,IAA8B,KAAzC,CAAX;;AAEA,YAAIC,cAAc,IAAI,qBAAOC,IAAP,CAAYC,MAAhB,CACd,KAAKT,KAAL,CAAWU,MAAX,CAAkBC,cADJ,EAEd,KAAKX,KAAL,CAAWU,MAAX,CAAkBE,kBAFJ,EAGd,sBAAoBT,IAHN,CAAlB;;AAMA,YAAIU,OAAON,YAAYO,eAAZ,CAA4B;AACnCC,yBAAa,SADsB;AAEnCC,mBAAO;AAF4B,SAA5B,CAAX;AAIA,8BAAYC,IAAZ,CAAiB,gBAAjB,EAAkCJ,IAAlC;;AAEA,YAAIK,SAAS,eAAKC,YAAL,EAAb;AACAD,eAAOE,MAAP,CAAcjB,IAAd;;AAEA,YAAIkB,YAAY,CAACC,OAAD,EAASC,QAAT,KAAoB;AAChCA,qBAASC,GAAT,CAAa,4DAAb;AACAN,mBAAOO,KAAP;;AAEA,gBAAIC,YAAY,cAAIC,KAAJ,CAAUL,QAAQM,GAAlB,EAAuB,IAAvB,CAAhB;AACA,gBAAGF,UAAUG,KAAV,CAAgBC,KAAnB,EAAyB;AACrBC,uBAAOC,MAAP,CAAcF,KAAd,CAAoBJ,UAAUG,KAAV,CAAgBC,KAApC;AACA,qBAAKG,QAAL;AACH,aAHD,MAGM;AACF,oBAAIC,OAAOR,UAAUG,KAAV,CAAgBK,IAA3B;;AAEA3B,4BAAY4B,QAAZ,CAAqBD,IAArB,EAA0B,CAACE,GAAD,EAAMC,MAAN,KAAgB;AACtC,wBAAGD,GAAH,EAAO;AACHL,+BAAOC,MAAP,CAAcF,KAAd,CAAoBM,GAApB;AACA,6BAAKpC,KAAL,CAAWC,KAAX,CAAiB6B,KAAjB,GAAyB,YAAzB;AACA,6BAAKG,QAAL;AACH,qBAJD,MAIK;AACD,6BAAKjC,KAAL,CAAWU,MAAX,CAAkB4B,iBAAlB,GAAsCD,OAAOE,YAA7C;AACA,6BAAKvC,KAAL,CAAWU,MAAX,CAAkB8B,kBAAlB,GAAuCH,OAAOI,aAA9C;AACA,6BAAKzC,KAAL,CAAWU,MAAX,CAAkBgC,oBAAlB,GAAyCL,OAAOM,WAAhD;AACA,6BAAKV,QAAL;AACH;AACJ,iBAXD;AAYH;AACJ,SAxBD;;AA0BAf,eAAO0B,EAAP,CAAU,SAAV,EAAoBvB,SAApB;AACH;;AAEDY,eAAU;AACN,aAAKjC,KAAL,CAAWC,KAAX,CAAiBC,WAAjB,GAA+B,IAA/B;AACA,YAAI2C,WAAW,KAAK7C,KAAL,CAAWC,KAAX,CAAiB4C,QAAhC;AACA,aAAK7C,KAAL,CAAWC,KAAX,CAAiB4C,QAAjB,GAA4B,EAA5B;AACA,aAAK7C,KAAL,CAAWC,KAAX,CAAiB6C,IAAjB,GAAwBD,QAAxB;AACH;;AAEDE,aAAQ;AACJ,eAAO;AAAA;AAAA,cAAK,WAAU,KAAf;AACH;AAAA;AAAA,kBAAK,WAAU,KAAf;AACI;AAAA;AAAA,sBAAI,WAAU,aAAd;AAAA;AAAA;AADJ;AADG,SAAP;AAKH;AA/DqC,C;kBAkE3BlD,W","file":"GoogleOAuth.js","sourcesContent":["import React from 'react';\nimport {ipcRenderer} from 'electron';\nimport {inject} from 'mobx-react';\nimport http from 'http';\nimport url from 'url';\nimport google from 'googleapis';\n\n@inject('config') @inject('state')\nclass GoogleOAuth extends React.Component {\n\n    componentDidMount(){\n        this.props.state.displayMenu = false;\n        let port = Math.floor(Math.random() * (65535-49152)+49152);\n\n        let OAuthClient = new google.auth.OAuth2(\n            this.props.config.GoogleClientId,\n            this.props.config.GoogleClientSecret,\n            \"http://127.0.0.1:\"+port\n        );\n\n        let gurl = OAuthClient.generateAuthUrl({\n            access_type: 'offline',\n            scope: 'https://www.googleapis.com/auth/drive.file',\n        });\n        ipcRenderer.send('openOAuthPanel',gurl);\n\n        let server = http.createServer();\n        server.listen(port);\n\n        let onRequest = (request,response)=>{\n            response.end('<html><head><script>window.close();</script></head></html>');\n            server.close();\n\n            let queryData = url.parse(request.url, true);\n            if(queryData.query.error){\n                window.logger.error(queryData.query.error);\n                this.pageBack();\n            }else {\n                let code = queryData.query.code;\n\n                OAuthClient.getToken(code,(err, tokens) =>{\n                    if(err){\n                        window.logger.error(err);\n                        this.props.state.error = 'oAuthError';\n                        this.pageBack();\n                    }else{\n                        this.props.config.GoogleAccessToken = tokens.access_token;\n                        this.props.config.GoogleRefreshToken = tokens.refresh_token;\n                        this.props.config.GoogleTokenValidTill = tokens.expiry_date;\n                        this.pageBack();\n                    }\n                })\n            }\n        };\n\n        server.on('request',onRequest);\n    }\n\n    pageBack(){\n        this.props.state.displayMenu = true;\n        let prevPage = this.props.state.prevPage;\n        this.props.state.prevPage = '';\n        this.props.state.page = prevPage;\n    }\n\n    render(){\n        return <div className=\"row\">\n            <div className=\"col\">\n                <h1 className=\"text-center\">Waiting for Google Login</h1>\n            </div>\n        </div>\n    }\n}\n\nexport default GoogleOAuth"]}